From amitaig@hailo.ai  Fri Jan  9 11:44:57 2026
From: Amitai Gottlieb <amitaig@hailo.ai>
Date: Tue, 16 Dec 2025 13:50:09 +0200
Subject: firmware: arm_scmi: Fix unused notifier-block in unregister
To: stable@vger.kernel.org
Cc: gregkh@linuxfoundation.org, sudeep.holla@arm.com, amitaigottlieb@gmail.com, Amitai Gottlieb <amitaig@hailo.ai>, Dan Carpenter <dan.carpenter@linaro.org>, Cristian Marussi <cristian.marussi@arm.com>
Message-ID: <20251216115009.30573-1-amitaig@hailo.ai>

From: Amitai Gottlieb <amitaig@hailo.ai>

In scmi_devm_notifier_unregister(), the notifier-block argument was ignored
and never passed to devres_release(). As a result, the function always
returned -ENOENT and failed to unregister the notifier.

Drivers that depend on this helper for teardown could therefore hit
unexpected failures, including kernel panics.

Commit 264a2c520628 ("firmware: arm_scmi: Simplify scmi_devm_notifier_unregister")
removed the faulty code path during refactoring and hence this fix is not
required upstream.

Cc: <stable@vger.kernel.org> # 5.15.x, 6.1.x, and 6.6.x
Fixes: 5ad3d1cf7d34 ("firmware: arm_scmi: Introduce new devres notification ops")
Reviewed-by: Dan Carpenter <dan.carpenter@linaro.org>
Reviewed-by: Cristian Marussi <cristian.marussi@arm.com>
Signed-off-by: Amitai Gottlieb <amitaig@hailo.ai>
Reviewed-by: Sudeep Holla <sudeep.holla@arm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
---
 drivers/firmware/arm_scmi/notify.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/firmware/arm_scmi/notify.c
+++ b/drivers/firmware/arm_scmi/notify.c
@@ -1539,6 +1539,7 @@ static int scmi_devm_notifier_unregister
 	dres.handle = sdev->handle;
 	dres.proto_id = proto_id;
 	dres.evt_id = evt_id;
+	dres.nb = nb;
 	if (src_id) {
 		dres.__src_id = *src_id;
 		dres.src_id = &dres.__src_id;
