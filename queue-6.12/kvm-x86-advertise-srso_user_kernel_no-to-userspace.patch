From stable+bounces-185886-greg=kroah.com@vger.kernel.org Thu Oct 16 09:52:03 2025
From: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Date: Thu, 16 Oct 2025 00:46:27 -0700
Subject: KVM: x86: Advertise SRSO_USER_KERNEL_NO to userspace
To: bp@alien8.de, stable@vger.kernel.org
Cc: boris.ostrovsky@oracle.com, Nikolay Borisov <nik.borisov@suse.com>, Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Message-ID: <20251016074627.3417836-1-harshit.m.mogalapalli@oracle.com>

From: "Borislav Petkov (AMD)" <bp@alien8.de>

[ Upstream commit 716f86b523d8ec3c17015ee0b03135c7aa6f2f08 ]

SRSO_USER_KERNEL_NO denotes whether the CPU is affected by SRSO across
user/kernel boundaries. Advertise it to guest userspace.

Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
Reviewed-by: Nikolay Borisov <nik.borisov@suse.com>
Link: https://lore.kernel.org/r/20241202120416.6054-3-bp@kernel.org
Signed-off-by: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
---
 arch/x86/kvm/cpuid.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/arch/x86/kvm/cpuid.c
+++ b/arch/x86/kvm/cpuid.c
@@ -816,7 +816,7 @@ void kvm_set_cpu_caps(void)
 		F(NO_NESTED_DATA_BP) | F(LFENCE_RDTSC) | 0 /* SmmPgCfgLock */ |
 		F(VERW_CLEAR) |
 		F(NULL_SEL_CLR_BASE) | F(AUTOIBRS) | 0 /* PrefetchCtlMsr */ |
-		F(WRMSR_XX_BASE_NS)
+		F(WRMSR_XX_BASE_NS) | F(SRSO_USER_KERNEL_NO)
 	);
 
 	kvm_cpu_cap_check_and_set(X86_FEATURE_SBPB);
